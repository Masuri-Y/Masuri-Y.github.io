<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>MyLinuxOps</title><meta name="author" content="Masuri"><meta name="copyright" content="Masuri"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta property="og:type" content="website">
<meta property="og:title" content="MyLinuxOps">
<meta property="og:url" content="http://www.mylinuxops.com/page/8/index.html">
<meta property="og:site_name" content="MyLinuxOps">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png">
<meta property="article:author" content="Masuri">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://www.mylinuxops.com/page/8/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MyLinuxOps',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2022-01-13 09:11:26'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">128</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">19</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/index.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">MyLinuxOps</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">MyLinuxOps</h1></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2019/03/16/Ansible/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible--7/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible%EF%BC%88%E4%B8%83%EF%BC%89/" title="自动化运维之Ansible（七）">     <img class="post_bg" src="/images/Ansible.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="自动化运维之Ansible（七）"></a></div><div class="recent-post-info"><a class="article-title" href="/2019/03/16/Ansible/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible--7/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible%EF%BC%88%E4%B8%83%EF%BC%89/" title="自动化运维之Ansible（七）">自动化运维之Ansible（七）</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2019-03-16T17:38:02.000Z" title="发表于 2019-03-16 17:38:02">2019-03-16</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Ansible/">Ansible</a></span></div><div class="content">Ansible-playbook中的变量在ansible的playbook中还可以使用变量，变量的命名必须符合其规则，仅能由字母、数字和下划线组成，且只能以字母开头。
Playbook中变量可以通过以下几种方法进行定义：



Ansible setup facts中已经定义好的变量
主机清单中定义变量
命令行下使用-e选项定义变量
在剧本中定义变量  
变量定义在一个专用的变量文件中

ansible setup facts 远程主机的所有变量都可直接调用使用ansible的setup模块可以查看远程主机上的所有变量，然后在yaml文件中直接进行调用。
1ansible HOSTLIST -m setup

此命令可以查看远程主机上所有已存在的各种变量，此处查看hostname的变量名
12345678910111213[root@ansible data]# ansible webserver -m setup -a &#x27;filter=*hostname&#x27;192.168.73.134 | SUCCESS =&gt; &#123;    &quot;ansible_ ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2019/03/16/Ansible/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible--6/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible%EF%BC%88%E5%85%AD%EF%BC%89/" title="自动化运维之Ansible（六）">     <img class="post_bg" src="/images/Ansible.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="自动化运维之Ansible（六）"></a></div><div class="recent-post-info"><a class="article-title" href="/2019/03/16/Ansible/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible--6/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible%EF%BC%88%E5%85%AD%EF%BC%89/" title="自动化运维之Ansible（六）">自动化运维之Ansible（六）</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2019-03-16T16:38:02.000Z" title="发表于 2019-03-16 16:38:02">2019-03-16</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Ansible/">Ansible</a></span></div><div class="content">ansible-playbook中标签的使用 tags在某些情况下，我们可能只需要选择性的执行playbook中的某一部分，这时候就需要用到playbook的标签(tags)功能，在playbook中添加标签可以让playbook在运行时选择性的执行被标签的内容。


playbook中标签的使用此处沿用上一节中所使用的httpd的yaml文件，再次将httpd.conf文件进行修改，上一节中httpd的端口从8080改为了80，在这里再次将端口从80改为8080。
修改httpd端口，将其改为8080
12[root@ansible data]# vim httpd.confListen 8080         #在配置文件中找到Listen，修改为8080

编辑yaml文件，对文件内的内容贴标签
1234567891011121314151617181920[root@ansible data]# vim httpd.yaml---#install httpd  - hosts: webserver    remote_user: root    tasks:      - n ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2019/03/16/Ansible/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible--5/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible%EF%BC%88%E4%BA%94%EF%BC%89/" title="自动化运维之Ansible（五）">     <img class="post_bg" src="/images/Ansible.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="自动化运维之Ansible（五）"></a></div><div class="recent-post-info"><a class="article-title" href="/2019/03/16/Ansible/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible--5/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible%EF%BC%88%E4%BA%94%EF%BC%89/" title="自动化运维之Ansible（五）">自动化运维之Ansible（五）</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2019-03-16T15:38:02.000Z" title="发表于 2019-03-16 15:38:02">2019-03-16</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Ansible/">Ansible</a></span></div><div class="content">playbook中的notify和handler当执行一个playbook时，第一次执行和第二次执行效果相同，当服务的配置文件发生变化时再次安装时已经启动的服务不会重启，此时就需要使用到notify。
notify的action可用于在每个play的最后被触发，这样可以避免多次有改变发生时每次都执行指定的操作，仅在所有的变化发生完成后一次性地执行指定操作。  
notify是触发条件，headlers是执行的任务


notify和handler的使用方法此处以上一节中的httpd为例，刚才已经启动了HTTP服务，http的端口为8080，此时再次修改httpd.conf，将端口改为80
12[root@ansible data]# vim /data/httpd.confListen 80

2.对yaml文件进行修改，增加notify及handlers
123456789101112131415161718[root@ansible data]# vim httpd.yaml---#install httpd  - hosts: webserver    remote_user:  ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2019/03/16/Ansible/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible--4/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible--4/" title="自动化运维之Ansible（四）">     <img class="post_bg" src="/images/Ansible.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="自动化运维之Ansible（四）"></a></div><div class="recent-post-info"><a class="article-title" href="/2019/03/16/Ansible/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible--4/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible--4/" title="自动化运维之Ansible（四）">自动化运维之Ansible（四）</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2019-03-16T14:38:02.000Z" title="发表于 2019-03-16 14:38:02">2019-03-16</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Ansible/">Ansible</a></span></div><div class="content">ansible的playbookansible-playbook为ansible的脚本，其是由yaml语言构成，这种语言对格式的要求非常高。


yaml语言的格式要求
在单一档案中，可以用连续三个连字号(—)区分多个档案，另外，还有选择性的连续三个点号_(…)来表示档案的结尾  
此行开始正常写playbook的内容，一般建议写明该playbook的功能
使用#注释代码  
缩进必须统一的，不能空格和tab混用  
缩进的级别也必须是一致的，同样的缩进代表同样的级别，程序判别配置的级别是通过缩进结合换行来实现的  
YAML文件内容是区分大小写的，k/v的值均需大小写敏感  
多个k/v可以同行写也可以换行写，同行使用，分割  
v可以是个字符串，也可以是另一个列表  
一个完整的代码块功能需最少元素包括name和task  
一个name只能包括一个task  
YAML文件扩展名通常为yaml或yml

示例：
123456789[root@ansible data]# vim hello.yaml---#hello world  - host: webserver    rem ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2019/03/16/Ansible/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible--3/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible%EF%BC%88%E4%B8%89%EF%BC%89/" title="自动化运维之Ansible（三）">     <img class="post_bg" src="/images/Ansible.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="自动化运维之Ansible（三）"></a></div><div class="recent-post-info"><a class="article-title" href="/2019/03/16/Ansible/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible--3/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible%EF%BC%88%E4%B8%89%EF%BC%89/" title="自动化运维之Ansible（三）">自动化运维之Ansible（三）</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2019-03-16T13:38:02.000Z" title="发表于 2019-03-16 13:38:02">2019-03-16</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Ansible/">Ansible</a></span></div><div class="content">自动化运维之Ansible（三）Ansible系列命令ansible有许多的命令，ansible、ansible-doc、ansible-playbook、ansible-vault、ansible-console、ansible-galaxy、ansible-pull，以下以较常用的几个命令做详细的说明。


ansible-doc命令ansible-doc用来显示ansible中各种模块的简要帮助信息
语法：
1ansible-doc [-l|-F|-s] [options] [-t &lt;plugin type&gt; ] [plugin]




选项
说明



-l
列出可用模块


-a
显示所有模块的文档


-s
显示指定模块的playbook片段


示例：
123456#列出所有模块[root@localhost ~]# ansible-doc -l#查看指定模块的用法[root@localhost ~]# ansible-doc ping#查看指定模块的简单用法[root@localhost ~]# ansible-doc -s ping

ansible命令 ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2019/03/16/Ansible/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible--8/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible%EF%BC%88%E5%85%AB%EF%BC%89/" title="自动化运维之Ansible（八）">     <img class="post_bg" src="/images/Ansible.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="自动化运维之Ansible（八）"></a></div><div class="recent-post-info"><a class="article-title" href="/2019/03/16/Ansible/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible--8/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible%EF%BC%88%E5%85%AB%EF%BC%89/" title="自动化运维之Ansible（八）">自动化运维之Ansible（八）</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2019-03-16T13:38:02.000Z" title="发表于 2019-03-16 13:38:02">2019-03-16</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Ansible/">Ansible</a></span></div><div class="content">ansible的模板template在某些环境下可能会出现这种情况，比如主机A配置文件中的某个值为1，主机B配置文件中此值为2，现在需要将此值在现有的基础上再加上2，此时ansible的模板就发挥其作用了，template可以根据模块文件动态生成相对应的配置文件。
template的格式要求template对文件的存放和命名有要求，template文件必须存放在templates目录下，并且以.j2后缀命名。  
yaml文件需要和templates目录平级，目录结构如下。


123456[root@ansible data]# tree yaml/yaml/├── hello.yaml├── httpd.yaml└── templates    └── test.conf.j2

template的使用方法准备环境此处以nginx为例，编写playbook为主机列表中的主机安装nginx  
1234567891011[root@ansible ~]# vim nginx.yml---#install nginx- hosts: webserver  remote_user: ro ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2019/03/16/Ansible/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible--2/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible%EF%BC%88%E4%BA%8C%EF%BC%89/" title="自动化运维之Ansible（二）">     <img class="post_bg" src="/images/Ansible.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="自动化运维之Ansible（二）"></a></div><div class="recent-post-info"><a class="article-title" href="/2019/03/16/Ansible/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible--2/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible%EF%BC%88%E4%BA%8C%EF%BC%89/" title="自动化运维之Ansible（二）">自动化运维之Ansible（二）</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2019-03-16T12:38:02.000Z" title="发表于 2019-03-16 12:38:02">2019-03-16</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Ansible/">Ansible</a></span></div><div class="content">自动化运维之Ansible（二）本文将讲述ansible的各种安装方式以及Ansible的配置文件


Ansible的安装ansible可以通过多种方法进行安装，yum、编译、pip和git，都能安装ansible以下演示ansible的各种安装方式
yum安装ansible安装最简单的方法可以使用rpm包进行安装，因为ansible已经被收入到的EPEL源中，在配置好yum源后就可以使用yum命令直接安装
1234#配置EPEL源[root@localhost ~]# yum install epel-release -y#安装ansible[root@localhost ~]# yum install ansible -y

编译安装编译安装ansible时需要先下载ansible的源码包，然后对其进行进行编译安装。
1234567891011121314#下载源码包[root@localhost ~]# wget https://releases.ansible.com/ansible/ansible-latest.tar.gz#安装编译所需的包组[root@localhost ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2019/03/16/Ansible/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible--1/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible--1/" title="自动化运维之Ansible（一）">     <img class="post_bg" src="/images/Ansible.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="自动化运维之Ansible（一）"></a></div><div class="recent-post-info"><a class="article-title" href="/2019/03/16/Ansible/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible--1/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E4%B9%8BAnsible--1/" title="自动化运维之Ansible（一）">自动化运维之Ansible（一）</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2019-03-16T11:38:02.000Z" title="发表于 2019-03-16 11:38:02">2019-03-16</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Ansible/">Ansible</a></span></div><div class="content">自动化运维之Ansible（一）工作中经常会面临到机器非常多，所接触到的主机可能是成百上千台以上，所以在管理那么多主机时必须要使用自动化管理工具对其进行管理，此时如果使用手工进行管理将是非常的费时费力的。


自动化运维应用场景自动化运维工具的应用场景通常会涉及到以下几种环境：
文件传输：比如将某软件的配置文件在某台服务器上配置完成，配置完成后要将其配置文件传送到其他的所有服务器上去，让其他的服务器上的软件也实现相同功能。
应用部署：比如说在某些服务器上安装一个数据库、一个web服务器软件或者缓存服务器的软件，对一批服务器进行批量的部署软件
配置管理：软件部署完毕后还需要对软件的配置文件进行批量的配置和管理，对配置文件进行批量的修改。
任务流编排：类似于编写脚本，对任务的顺序进行编排，人工手动执行过于麻烦
常用自动化运维工具Ansible：红帽公司的员工所研发，后来被红帽公司收购。使用python编写，ansible是无代理的，无代理表示安装ansible的机器可以对成千上万台机器进行管理，而被管理的软件无需安装客户端就可以被ansible管理，这主要是因为ansible是基于ssh- ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2019/03/14/Linux%E5%9F%BA%E7%A1%80/%E5%AE%9E%E7%8E%B0Internet-dns%E6%9E%B6%E6%9E%84/%E5%AE%9E%E7%8E%B0Internet-dns%E6%9E%B6%E6%9E%84/" title="互联网DNS架构的实现">     <img class="post_bg" src="/images/Linux.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="互联网DNS架构的实现"></a></div><div class="recent-post-info"><a class="article-title" href="/2019/03/14/Linux%E5%9F%BA%E7%A1%80/%E5%AE%9E%E7%8E%B0Internet-dns%E6%9E%B6%E6%9E%84/%E5%AE%9E%E7%8E%B0Internet-dns%E6%9E%B6%E6%9E%84/" title="互联网DNS架构的实现">互联网DNS架构的实现</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2019-03-14T13:38:02.000Z" title="发表于 2019-03-14 13:38:02">2019-03-14</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Linux%E5%9F%BA%E7%A1%80/">Linux基础</a></span></div><div class="content">互联网DNS架构的实现互联网中dns的架构为下图所示，当本地的DNS服务器无法解析域名时就会向互联网上的dns服务器去迭代查询，直到找到相应的服务器位置。



以下为具体的实现方式
环境准备


主机
OS
IP



www
centos6
192.168.73.2


client
centos6
192.168.73.3


mylinuxopsdns1
centos7
192.168.73.10


mylinuxopsdns2
centos7
192.168.73.20


comdns
centos7
192.168.73.30


rootdns
centos7
192.168.73.40


ldns
centos7
192.168.73.50



一、在www主机上部署httpd服务1.启动httpd服务1234[root@www ~]# service httpd startStarting httpd: httpd: apr_sockaddr_info_get() failed for wwwhttpd: Could not reliably determin ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2019/03/14/Linux%E5%9F%BA%E7%A1%80/DNS%E8%BD%AC%E5%8F%91/DNS%E8%BD%AC%E5%8F%91/" title="DNS转发">     <img class="post_bg" src="/images/Linux.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="DNS转发"></a></div><div class="recent-post-info"><a class="article-title" href="/2019/03/14/Linux%E5%9F%BA%E7%A1%80/DNS%E8%BD%AC%E5%8F%91/DNS%E8%BD%AC%E5%8F%91/" title="DNS转发">DNS转发</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2019-03-14T11:40:02.000Z" title="发表于 2019-03-14 11:40:02">2019-03-14</time></span><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Linux%E5%9F%BA%E7%A1%80/">Linux基础</a></span></div><div class="content">DNS转发dns转发分为2种，全局转发和特定区域转发。
全局转发是对非本机所负责解析区域的请求，全部转发给指定的服务器。
特定区域转发是仅转发对特定的区域的请求，比全局转发优先级高。
转发分为2种模式：first和only  
first模式：先到本地DNS查找，若本地dns查找不到记录，去其他的dns服务器查找，若其他dns服务器也没有，直接去根服务器查找   
only模式：先到本地DNS查找，若本地dns查找不到记录，去其他的dns服务器查找，若其他dns服务器也没有，直接放弃。



全局转发的only模式准备客户机一台，dns服务器两台，将dns1服务器的转发地址者设置为dns2，dns1有两个网卡一个是内网，一个是外网，dns2只有一个连接内网的网卡



主机
ip



client
192.168.73.120


dns1
192.168.73.10    172.22.145.220


dns2
192.168.73.30


分别在dns1、dns2上配置dns服务  
在dns2上部署配置dns
123456789101112[root@dns2 ~]# y ...</div></div></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/7/#content-inner"><i class="fas fa-chevron-left fa-fw"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/#content-inner">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/#content-inner">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/#content-inner">13</a><a class="extend next" rel="next" href="/page/9/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Masuri</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">128</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">19</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/01/12/hello-world/" title="Hello World"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hello World"/></a><div class="content"><a class="title" href="/2022/01/12/hello-world/" title="Hello World">Hello World</a><time datetime="2022-01-12T12:50:44.471Z" title="发表于 2022-01-12 12:50:44">2022-01-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2019/06/10/Docker/docker%E7%9A%84%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C/docker%E7%9A%84%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C/" title="docker的镜像与制作"><img src="/images/docker.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="docker的镜像与制作"/></a><div class="content"><a class="title" href="/2019/06/10/Docker/docker%E7%9A%84%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C/docker%E7%9A%84%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C/" title="docker的镜像与制作">docker的镜像与制作</a><time datetime="2019-06-10T07:55:02.000Z" title="发表于 2019-06-10 07:55:02">2019-06-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2019/06/10/Docker/docker-harbor/docker-harbor/" title="Docker Harbor"><img src="/images/docker.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Docker Harbor"/></a><div class="content"><a class="title" href="/2019/06/10/Docker/docker-harbor/docker-harbor/" title="Docker Harbor">Docker Harbor</a><time datetime="2019-06-10T06:55:02.000Z" title="发表于 2019-06-10 06:55:02">2019-06-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2019/06/10/Docker/docker%E5%AD%98%E5%82%A8%E5%8D%B7/docker%E5%AD%98%E5%82%A8%E5%8D%B7/" title="Docker存储卷"><img src="/images/docker.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Docker存储卷"/></a><div class="content"><a class="title" href="/2019/06/10/Docker/docker%E5%AD%98%E5%82%A8%E5%8D%B7/docker%E5%AD%98%E5%82%A8%E5%8D%B7/" title="Docker存储卷">Docker存储卷</a><time datetime="2019-06-10T06:55:02.000Z" title="发表于 2019-06-10 06:55:02">2019-06-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2019/06/10/Docker/docker%E9%95%9C%E5%83%8F/docker%E7%9A%84%E9%95%9C%E5%83%8F/" title="docker的镜像管理"><img src="/images/docker.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="docker的镜像管理"/></a><div class="content"><a class="title" href="/2019/06/10/Docker/docker%E9%95%9C%E5%83%8F/docker%E7%9A%84%E9%95%9C%E5%83%8F/" title="docker的镜像管理">docker的镜像管理</a><time datetime="2019-06-10T06:51:02.000Z" title="发表于 2019-06-10 06:51:02">2019-06-10</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分类</span>
            <a class="card-more-btn" href="/categories/" title="查看更多">
    <i class="fas fa-angle-right"></i></a>
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Ansible/"><span class="card-category-list-name">Ansible</span><span class="card-category-list-count">13</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Apache/"><span class="card-category-list-name">Apache</span><span class="card-category-list-count">8</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/CICD/"><span class="card-category-list-name">CICD</span><span class="card-category-list-count">12</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Docker/"><span class="card-category-list-name">Docker</span><span class="card-category-list-count">10</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Linux%E5%9F%BA%E7%A1%80/"><span class="card-category-list-name">Linux基础</span><span class="card-category-list-count">42</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/MySQL/"><span class="card-category-list-name">MySQL</span><span class="card-category-list-count">33</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/hexo/"><span class="card-category-list-name">hexo</span><span class="card-category-list-count">2</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/kubernetes/"><span class="card-category-list-name">kubernetes</span><span class="card-category-list-count">1</span></a></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/Ansible/" style="font-size: 1.41em; color: #99a5b7">Ansible</a> <a href="/tags/Apache/" style="font-size: 1.32em; color: #99a2ae">Apache</a> <a href="/tags/DNS/" style="font-size: 1.19em; color: #999da1">DNS</a> <a href="/tags/Docker/" style="font-size: 1.37em; color: #99a4b2">Docker</a> <a href="/tags/Jenkins/" style="font-size: 1.32em; color: #99a2ae">Jenkins</a> <a href="/tags/Linux%E5%9F%BA%E7%A1%80/" style="font-size: 1.46em; color: #99a7bb">Linux基础</a> <a href="/tags/MySQL/" style="font-size: 1.5em; color: #99a9bf">MySQL</a> <a href="/tags/OpenSSH/" style="font-size: 1.19em; color: #999da1">OpenSSH</a> <a href="/tags/OpenSSL/" style="font-size: 1.1em; color: #999">OpenSSL</a> <a href="/tags/awk/" style="font-size: 1.1em; color: #999">awk</a> <a href="/tags/gitlab/" style="font-size: 1.23em; color: #999ea6">gitlab</a> <a href="/tags/grub%E4%BF%AE%E5%A4%8D/" style="font-size: 1.23em; color: #999ea6">grub修复</a> <a href="/tags/hexo/" style="font-size: 1.14em; color: #999b9d">hexo</a> <a href="/tags/kubernetes/" style="font-size: 1.1em; color: #999">kubernetes</a> <a href="/tags/security/" style="font-size: 1.1em; color: #999">security</a> <a href="/tags/%E7%B3%BB%E7%BB%9F%E4%BF%AE%E5%A4%8D/" style="font-size: 1.19em; color: #999da1">系统修复</a> <a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 1.23em; color: #999ea6">网络</a> <a href="/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%AE%89%E8%A3%85%E7%B3%BB%E7%BB%9F/" style="font-size: 1.14em; color: #999b9d">自动化安装系统</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" style="font-size: 1.28em; color: #99a0aa">计算机基础</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/01/"><span class="card-archive-list-date">一月 2022</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2019/06/"><span class="card-archive-list-date">六月 2019</span><span class="card-archive-list-count">10</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2019/05/"><span class="card-archive-list-date">五月 2019</span><span class="card-archive-list-count">13</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2019/04/"><span class="card-archive-list-date">四月 2019</span><span class="card-archive-list-count">41</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2019/03/"><span class="card-archive-list-date">三月 2019</span><span class="card-archive-list-count">61</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2019/01/"><span class="card-archive-list-date">一月 2019</span><span class="card-archive-list-count">2</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">128</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2022-01-13T09:11:25.588Z"></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Masuri</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>